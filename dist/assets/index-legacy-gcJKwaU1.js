System.register([],(function(e,o){"use strict";return{execute:function(){var e=document.createElement("style");e.textContent='.add-story-container{max-width:800px;margin:2rem auto;background-color:#fff;padding:2rem;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,.1)}.add-story-container h2{text-align:center;margin-bottom:1.5rem;font-weight:700}.add-story-container h2 .text-primary{color:#3a86ff}.add-story-container h2 .text-secondary{color:#ff5e5b}.form-group{margin-bottom:1.5rem}.form-group label{display:block;margin-bottom:.5rem;font-weight:500}textarea#description{width:100%;min-height:120px;padding:12px;border:1px solid #e0e0e0;border-radius:8px;font-family:inherit;resize:vertical}textarea#description:focus{outline:none;border-color:#3a86ff;box-shadow:0 0 0 3px rgba(58,134,255,.25)}.camera-section,.location-section{background-color:#f8f9fc;padding:1.5rem;border-radius:12px;margin-bottom:1.5rem;border-left:4px solid #3a86ff}.camera-section h3,.location-section h3{margin-top:0;color:#3a86ff;font-size:1.25rem;margin-bottom:1rem}.camera-preview{width:100%;height:300px;background-color:#eaeaea;border-radius:8px;overflow:hidden;margin-bottom:1rem;position:relative}#cameraFeed,#capturedImage{width:100%;height:100%;object-fit:cover}.camera-controls{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}.camera-controls button{padding:10px;border-radius:8px;border:1px solid #e0e0e0;background-color:#fff;cursor:pointer;transition:all .3s}.camera-controls button:hover:not(:disabled){background-color:#3a86ff;color:#fff;border-color:#3a86ff}.camera-controls button:disabled{opacity:.5;cursor:not-allowed}#pickLocationMap{width:100%;height:300px;border-radius:8px;margin-bottom:1rem}.location-info{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:.5rem}.location-info p{margin:0;padding:8px 12px;background-color:#fff;border-radius:8px;border:1px solid #e0e0e0}.hint{font-size:.875rem;color:#6c757d;margin-top:.5rem}.submit-btn{background-color:#3a86ff;color:#fff;border:none;padding:12px 24px;border-radius:8px;font-weight:500;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;margin:0 auto}.submit-btn:hover{background-color:#2667cc;transform:translateY(-2px);box-shadow:0 4px 8px rgba(58,134,255,.25)}#messageContainer{margin-bottom:1rem}.message{padding:12px;border-radius:8px;margin-bottom:1rem;animation:fadeIn .3s ease}.message.success{background-color:rgba(6,214,160,.1);border-left:4px solid #06d6a0;color:#06d6a0}.message.error{background-color:rgba(239,71,111,.1);border-left:4px solid #ef476f;color:#ef476f}.loading-indicator{display:none;align-items:center;justify-content:center;gap:10px;margin:1rem 0}.loading-indicator i{animation:spin 1s infinite linear}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}@media (max-width: 768px){.add-story-container{padding:1.25rem;margin:1rem}.camera-preview,#pickLocationMap{height:250px}.camera-controls{grid-template-columns:1fr}}.auth-section{padding:2rem 0;background-color:#f8f9fa;min-height:calc(100vh - 300px);display:flex;align-items:center}.auth-card{background-color:#fff;border-radius:10px;box-shadow:0 2px 20px rgba(0,0,0,.08);padding:2.5rem;max-width:450px;margin:0 auto;width:100%}.auth-card .form-group{margin-bottom:1.5rem}.auth-card input{border:1px solid #e2e8f0;border-radius:8px;padding:.75rem 1rem;font-size:1rem;width:100%;background-color:#f8fafc;transition:all .3s ease}.auth-card input:focus{border-color:var(--color-primary);background-color:#fff;box-shadow:0 0 0 3px rgba(66,153,225,.15);outline:none}.auth-card label{display:block;margin-bottom:.5rem;font-weight:500;color:#4a5568}.btn-primary{background-color:var(--color-primary);border:none;border-radius:8px;color:#fff;font-weight:600;padding:.75rem 1rem;cursor:pointer;transition:all .3s ease;width:100%}.btn-primary:hover{background-color:var(--color-primary-dark, #3182ce);transform:translateY(-2px)}.auth-link{color:var(--color-primary);font-weight:500;text-decoration:none}.auth-link:hover{text-decoration:underline}.auth-header{text-align:center;margin-bottom:2rem}.auth-title{color:var(--color-primary);font-size:1.75rem;margin-bottom:.5rem}.auth-subtitle{color:#718096}.input-icon-wrapper{position:relative}.input-icon{position:absolute;left:1rem;top:50%;transform:translateY(-50%);color:#a0aec0}.input-icon-wrapper input{padding-left:2.5rem}.story-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:var(--spacing-lg);margin-top:var(--spacing-lg)}.story-card{background-color:var(--color-surface);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-md);transition:transform var(--transition-normal),box-shadow var(--transition-normal);height:100%;display:flex;flex-direction:column}.story-card:hover,.story-card:focus-within{transform:translateY(-5px);box-shadow:var(--shadow-lg)}.story-image-container{position:relative;height:200px;overflow:hidden}.story-image{width:100%;height:100%;object-fit:cover;transition:transform var(--transition-slow)}.story-card:hover .story-image{transform:scale(1.05)}.story-location-badge{position:absolute;bottom:var(--spacing-sm);left:var(--spacing-sm);background-color:rgba(0,0,0,.7);color:#fff;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-full);font-size:.75rem;display:flex;align-items:center;gap:var(--spacing-xs)}.story-content{padding:var(--spacing-md);display:flex;flex-direction:column;flex-grow:1}.story-title{margin-top:0;margin-bottom:var(--spacing-sm);font-size:1.25rem}.story-meta{display:flex;justify-content:space-between;color:var(--color-text-light);font-size:.875rem;margin-bottom:var(--spacing-md)}.story-author{display:flex;align-items:center;gap:var(--spacing-xs)}.story-description{margin-bottom:var(--spacing-md);flex-grow:1}.story-footer{margin-top:auto}.btn-view-on-map{background:none;border:none;color:var(--color-primary);display:flex;align-items:center;gap:var(--spacing-xs);padding:var(--spacing-xs) 0;font-size:.875rem;transition:color var(--transition-fast)}.btn-view-on-map:hover{color:var(--color-primary-dark);text-decoration:underline}.form-group{margin-bottom:var(--spacing-lg)}.form-label{display:block;margin-bottom:var(--spacing-xs);font-weight:500}.form-control{width:100%;padding:var(--spacing-sm) var(--spacing-md);border:1px solid var(--color-border);border-radius:var(--radius-md);font-family:var(--font-body);font-size:1rem;transition:border-color var(--transition-fast),box-shadow var(--transition-fast)}.form-control:focus{outline:none;border-color:var(--color-primary);box-shadow:0 0 0 3px rgba(58,134,255,.25)}.form-error{color:var(--color-error);font-size:.875rem;margin-top:var(--spacing-xs)}.form-textarea{min-height:120px;resize:vertical}.file-input-container{position:relative}.file-input{position:absolute;width:.1px;height:.1px;opacity:0;overflow:hidden;z-index:-1}.file-input-label{display:flex;align-items:center;justify-content:center;padding:var(--spacing-md);background-color:#f8f9fa;border:2px dashed var(--color-border);border-radius:var(--radius-md);cursor:pointer;text-align:center;transition:background-color var(--transition-fast),border-color var(--transition-fast)}.file-input-label:hover,.file-input-label:focus{background-color:#e9ecef;border-color:var(--color-primary)}.file-input-label i{font-size:2rem;color:var(--color-text-light);margin-bottom:var(--spacing-sm)}.file-preview{max-width:100%;max-height:200px;margin-top:var(--spacing-md);border-radius:var(--radius-md)}.tabs{display:flex;border-bottom:1px solid var(--color-border);margin-bottom:var(--spacing-lg)}.tab-button{background:none;border:none;padding:var(--spacing-sm) var(--spacing-lg);font-family:var(--font-body);font-weight:500;color:var(--color-text-light);position:relative;transition:color var(--transition-fast)}.tab-button.active{color:var(--color-primary)}.tab-button.active:after{content:"";position:absolute;bottom:-1px;left:0;width:100%;height:3px;background-color:var(--color-primary);border-radius:var(--radius-sm) var(--radius-sm) 0 0}.tab-content{display:none}.tab-content.active{display:block;animation:fade-in .3s ease}.toast-container{position:fixed;bottom:var(--spacing-lg);right:var(--spacing-lg);z-index:1000;display:flex;flex-direction:column;gap:var(--spacing-sm)}.toast{background-color:var(--color-surface);border-left:4px solid var(--color-primary);box-shadow:var(--shadow-lg);border-radius:var(--radius-md);padding:var(--spacing-sm) var(--spacing-lg);display:flex;align-items:center;gap:var(--spacing-sm);max-width:300px;animation:slide-in-right .3s ease forwards}.toast.success{border-left-color:var(--color-success)}.toast.error{border-left-color:var(--color-error)}.toast.warning{border-left-color:var(--color-warning)}.toast-icon{font-size:1.25rem}.toast.success .toast-icon{color:var(--color-success)}.toast.error .toast-icon{color:var(--color-error)}.toast.warning .toast-icon{color:var(--color-warning)}.toast-content{flex:1}.toast-close{background:none;border:none;font-size:1rem;color:var(--color-text-light);cursor:pointer;transition:color var(--transition-fast)}.toast-close:hover{color:var(--color-text)}@keyframes slide-in-right{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes slide-out-right{0%{transform:translate(0);opacity:1}to{transform:translate(100%);opacity:0}}.card{background-color:var(--color-surface);border-radius:var(--radius-lg);box-shadow:var(--shadow-md);overflow:hidden}.card-header{padding:var(--spacing-md);border-bottom:1px solid var(--color-border)}.card-body{padding:var(--spacing-lg)}.card-footer{padding:var(--spacing-md);border-top:1px solid var(--color-border);display:flex;justify-content:flex-end}.badge{display:inline-flex;align-items:center;padding:var(--spacing-xs) var(--spacing-sm);border-radius:var(--radius-full);font-size:.75rem;font-weight:500}.badge-primary{background-color:rgba(58,134,255,.1);color:var(--color-primary)}.badge-secondary{background-color:rgba(255,94,91,.1);color:var(--color-secondary)}.featured-stories,.how-it-works,.testimonials{padding:3rem 0}.section-title{text-align:center;margin-bottom:2rem;color:var(--color-primary);position:relative}.section-title:after{content:"";display:block;width:50px;height:3px;background:var(--color-accent);margin:.5rem auto 0}.featured-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem}.featured-placeholder{text-align:center;padding:3rem 2rem;background-color:rgba(58,134,255,.05);border-radius:8px;border:1px dashed rgba(58,134,255,.3)}.placeholder-icon{font-size:3rem;color:var(--color-primary);margin-bottom:1rem}.steps-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem}.step-card{text-align:center;padding:2rem;background-color:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.05);transition:transform .3s ease}.step-card:hover{transform:translateY(-5px)}.step-icon{width:70px;height:70px;display:flex;align-items:center;justify-content:center;background-color:rgba(58,134,255,.1);color:var(--color-primary);border-radius:50%;font-size:1.75rem;margin:0 auto 1rem}.testimonial-carousel{max-width:700px;margin:0 auto}.testimonial-card{background-color:#fff;border-radius:8px;padding:2rem;box-shadow:0 4px 12px rgba(0,0,0,.05)}.testimonial-content{font-style:italic;margin-bottom:1.5rem;font-size:1.1rem;color:#4a4a4a}.testimonial-author{display:flex;align-items:center}.author-avatar{font-size:2.5rem;color:#adb5bd;margin-right:1rem}.author-info h4{margin:0;color:#333}.author-info p{margin:0;color:#6c757d}@media (max-width: 768px){.featured-stories,.how-it-works,.testimonials{padding:2rem 1rem}.steps-container{gap:1rem}.step-card{padding:1.5rem}}:root{--color-primary: #3a86ff;--color-primary-dark: #2667cc;--color-secondary: #ff5e5b;--color-accent: #8338ec;--color-success: #06d6a0;--color-warning: #ffbe0b;--color-error: #ef476f;--color-surface: #ffffff;--color-background: #f7f9fc;--color-text: #1d3557;--color-text-light: #6c757d;--color-border: #e0e0e0;--font-heading: "Playfair Display", serif;--font-body: "Poppins", sans-serif;--spacing-xs: .25rem;--spacing-sm: .5rem;--spacing-md: 1rem;--spacing-lg: 1.5rem;--spacing-xl: 2rem;--spacing-xxl: 3rem;--radius-sm: 4px;--radius-md: 8px;--radius-lg: 16px;--radius-full: 9999px;--shadow-sm: 0 2px 4px rgba(0, 0, 0, .05);--shadow-md: 0 4px 6px rgba(0, 0, 0, .1);--shadow-lg: 0 10px 15px rgba(0, 0, 0, .1);--transition-fast: .15s ease;--transition-normal: .3s ease;--transition-slow: .5s ease}*{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth;font-size:16px}body{font-family:var(--font-body);color:var(--color-text);background-color:var(--color-background);line-height:1.6;min-height:100vh;display:flex;flex-direction:column}main{flex:1}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);line-height:1.2;margin-bottom:var(--spacing-md);color:var(--color-text)}h1{font-size:2.5rem}h2{font-size:2rem}h3{font-size:1.75rem}h4{font-size:1.5rem}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-bottom:var(--spacing-md)}a{color:var(--color-primary);text-decoration:none;transition:color var(--transition-fast)}a:hover,a:focus{color:var(--color-primary-dark);text-decoration:underline}img{max-width:100%;height:auto}button{cursor:pointer;font-family:var(--font-body)}ul,ol{padding-left:var(--spacing-lg);margin-bottom:var(--spacing-md)}.container{width:100%;max-width:1200px;margin:0 auto;padding:0 var(--spacing-md)}.skip-link{position:absolute;top:-40px;left:0;padding:var(--spacing-sm) var(--spacing-md);background-color:var(--color-primary);color:#fff;z-index:1000;transition:top var(--transition-fast)}.skip-link:focus{top:0}.app-header{background-color:var(--color-surface);box-shadow:var(--shadow-sm);padding:var(--spacing-md) 0;position:sticky;top:0;z-index:100}.app-header .container{display:flex;justify-content:space-between;align-items:center}.app-brand a{display:flex;align-items:center;color:var(--color-text);text-decoration:none;font-size:1.5rem}.app-brand i{margin-right:var(--spacing-sm);color:var(--color-primary)}.app-brand .accent{color:var(--color-secondary);font-weight:700}.nav-menu{display:flex;list-style:none;margin:0;padding:0;gap:var(--spacing-md)}.nav-menu a{display:flex;align-items:center;padding:var(--spacing-sm) var(--spacing-md);color:var(--color-text);font-weight:500;text-decoration:none;border-radius:var(--radius-md);transition:background-color var(--transition-fast)}.nav-menu a i{margin-right:var(--spacing-sm)}.nav-menu a:hover,.nav-menu a:focus,.nav-menu a[aria-current=page]{background-color:rgba(58,134,255,.1);color:var(--color-primary)}#navToggle{display:none;background:none;border:none;font-size:1.5rem;color:var(--color-text)}.app-footer{background-color:var(--color-text);color:#fff;padding:var(--spacing-xl) 0;margin-top:var(--spacing-xxl)}.footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:var(--spacing-xl);margin-bottom:var(--spacing-xl)}.footer-brand h2{color:#fff;display:flex;align-items:center;margin-bottom:var(--spacing-md)}.footer-brand h2 i{margin-right:var(--spacing-sm);color:var(--color-primary)}.footer-links h3,.footer-contact h3{color:#fff;margin-bottom:var(--spacing-md);font-size:1.2rem}.footer-links ul{list-style:none;padding:0;margin:0}.footer-links li{margin-bottom:var(--spacing-sm)}.footer-links a{color:rgba(255,255,255,.8);text-decoration:none;transition:color var(--transition-fast)}.footer-links a:hover{color:#fff;text-decoration:underline}.footer-contact p{margin-bottom:var(--spacing-sm)}.footer-copyright{text-align:center;padding-top:var(--spacing-lg);border-top:1px solid rgba(255,255,255,.1)}.loading-container{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:200px}.loading-spinner{width:40px;height:40px;border:4px solid rgba(58,134,255,.3);border-radius:50%;border-top-color:var(--color-primary);animation:spin 1s ease-in-out infinite;margin-bottom:var(--spacing-md)}@keyframes spin{to{transform:rotate(360deg)}}.visually-hidden{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}.text-center{text-align:center}.section-title{position:relative;padding-bottom:var(--spacing-sm);margin-bottom:var(--spacing-lg)}.section-title:after{content:"";position:absolute;bottom:0;left:0;width:80px;height:4px;background-color:var(--color-primary);border-radius:var(--radius-full)}.btn{display:inline-flex;align-items:center;justify-content:center;background-color:var(--color-primary);color:#fff;border:none;border-radius:var(--radius-md);padding:var(--spacing-sm) var(--spacing-lg);font-weight:500;transition:background-color var(--transition-fast),transform var(--transition-fast);text-decoration:none}.btn i{margin-right:var(--spacing-sm)}.btn:hover,.btn:focus{background-color:var(--color-primary-dark);transform:translateY(-2px);color:#fff;text-decoration:none}.btn-secondary{background-color:var(--color-secondary)}.btn-secondary:hover,.btn-secondary:focus{background-color:#e54946}.btn-outline{background-color:transparent;border:2px solid var(--color-primary);color:var(--color-primary)}.btn-outline:hover,.btn-outline:focus{background-color:var(--color-primary);color:#fff}@media (max-width: 768px){.nav-menu{position:fixed;top:60px;left:0;right:0;background-color:var(--color-surface);flex-direction:column;padding:var(--spacing-md);box-shadow:var(--shadow-md);transform:translateY(-100%);opacity:0;pointer-events:none;transition:transform var(--transition-normal),opacity var(--transition-normal);z-index:99}.nav-menu.active{transform:translateY(0);opacity:1;pointer-events:all}#navToggle{display:block}.app-header{padding:var(--spacing-sm) 0}h1{font-size:2rem}h2{font-size:1.75rem}}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes slide-up{0%{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}main.view-transition{animation:fade-in .3s ease forwards}.view-transition-element{animation:slide-up .4s ease forwards}@supports (view-transition-name: page){.view-transition{view-transition-name:page}::view-transition-old(root){animation:.3s cubic-bezier(.4,0,.2,1) both fade-out}::view-transition-new(root){animation:.3s cubic-bezier(.4,0,.2,1) both fade-in}::view-transition-old(page){animation:.4s cubic-bezier(.4,0,.2,1) both slide-to-left}::view-transition-new(page){animation:.4s cubic-bezier(.4,0,.2,1) both slide-from-right}@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-out{0%{opacity:1}to{opacity:0}}@keyframes slide-from-right{0%{transform:translate(50px);opacity:0}to{transform:translate(0);opacity:1}}@keyframes slide-to-left{0%{transform:translate(0);opacity:1}to{transform:translate(-50px);opacity:0}}}@supports not (view-transition-name: page){#mainContent{transition:opacity .3s ease}.page-transitioning{opacity:0}}.offline-indicator{position:fixed;top:0;left:0;right:0;background-color:#f8d7da;color:#721c24;padding:10px;text-align:center;z-index:9999;transform:translateY(-100%);transition:transform .3s ease-in-out;box-shadow:0 2px 4px rgba(0,0,0,.1)}.offline-indicator.visible{transform:translateY(0)}.offline-content{display:flex;align-items:center;justify-content:center;gap:10px}.offline-content i{font-size:1.2rem}.online-msg{position:fixed;top:10px;right:10px;background-color:#d4edda;color:#155724;padding:10px 20px;border-radius:4px;z-index:9999;box-shadow:0 2px 8px rgba(0,0,0,.1);animation:slide-in .3s ease-out}.online-msg.fade-out{animation:fade-out .5s ease-out forwards}@keyframes slide-in{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes fade-out{0%{opacity:1}to{opacity:0}}.update-notification{position:fixed;bottom:20px;right:20px;background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:15px;box-shadow:0 4px 12px rgba(0,0,0,.15);z-index:9999;max-width:300px;display:flex;flex-direction:column;gap:10px}.update-notification p{margin:0;font-size:14px}.update-notification button{background-color:#4299e1;color:#fff;border:none;padding:8px 12px;border-radius:4px;cursor:pointer;font-weight:500;transition:background-color .2s}.update-notification button:hover{background-color:#3182ce}\n/*$vite$:1*/',document.head.appendChild(e);class o{static dbPromise=null;static async openDB(){return this.dbPromise||(this.dbPromise=new Promise(((e,o)=>{console.log("Opening IndexedDB");const r=indexedDB.open("petabicara-db",1);r.onupgradeneeded=e=>{console.log("Upgrading IndexedDB");const o=e.target.result;o.objectStoreNames.contains("stories")||(console.log("Creating stories object store"),o.createObjectStore("stories",{keyPath:"id"})),o.objectStoreNames.contains("offlineQueue")||(console.log("Creating offlineQueue object store"),o.createObjectStore("offlineQueue",{keyPath:"id",autoIncrement:!0}))},r.onsuccess=()=>{console.log("IndexedDB opened successfully"),e(r.result)},r.onerror=()=>{console.error("Error opening IndexedDB",r.error),o(r.error)}}))),this.dbPromise}static async saveStories(e){try{const o=(await this.openDB()).transaction("stories","readwrite"),r=o.objectStore("stories");return console.log(`Saving ${e.length} stories to IndexedDB`),e.forEach((e=>{r.put(e)})),new Promise(((e,r)=>{o.oncomplete=()=>{console.log("Stories saved successfully"),e(!0)},o.onerror=()=>{console.error("Error saving stories",o.error),r(o.error)}}))}catch(o){throw console.error("Failed to save stories to IndexedDB",o),o}}static async getStories(){try{const e=await this.openDB(),o=e.transaction("stories","readonly").objectStore("stories");return new Promise(((e,r)=>{const t=o.getAll();t.onsuccess=()=>{console.log(`Retrieved ${t.result.length} stories from IndexedDB`),e(t.result)},t.onerror=()=>{console.error("Error getting stories from IndexedDB",t.error),r(t.error)}}))}catch(e){return console.error("Failed to get stories from IndexedDB",e),[]}}static async getStoryById(e){try{const o=await this.openDB(),r=o.transaction("stories","readonly").objectStore("stories");return new Promise(((o,t)=>{const n=r.get(e);n.onsuccess=()=>{o(n.result)},n.onerror=()=>{console.error("Error getting story by ID",n.error),t(n.error)}}))}catch(o){return console.error(`Failed to get story with ID ${e} from IndexedDB`,o),null}}static async deleteStory(e){try{const o=(await this.openDB()).transaction("stories","readwrite"),r=o.objectStore("stories");return console.log(`Deleting story with ID ${e} from IndexedDB`),r.delete(e),new Promise(((r,t)=>{o.oncomplete=()=>{console.log(`Story ${e} deleted successfully`),r(!0)},o.onerror=()=>{console.error("Error deleting story",o.error),t(o.error)}}))}catch(o){throw console.error(`Failed to delete story with ID ${e} from IndexedDB`,o),o}}static async saveOfflineStory(e){try{const o=(await this.openDB()).transaction("offlineQueue","readwrite"),r=o.objectStore("offlineQueue"),t={id:`offline-${Date.now()}`,type:"add-story",data:e,timestamp:(new Date).getTime()};return console.log("Saving story to offline queue",t),r.add(t),new Promise(((e,r)=>{o.oncomplete=()=>{console.log("Story saved to offline queue successfully"),e(t.id)},o.onerror=()=>{console.error("Error saving to offline queue",o.error),r(o.error)}}))}catch(o){throw console.error("Failed to save to offline queue",o),o}}static async getOfflineQueue(){try{const e=await this.openDB(),o=e.transaction("offlineQueue","readonly").objectStore("offlineQueue");return new Promise(((e,r)=>{const t=o.getAll();t.onsuccess=()=>{console.log(`Retrieved ${t.result.length} items from offline queue`),e(t.result)},t.onerror=()=>{console.error("Error getting offline queue",t.error),r(t.error)}}))}catch(e){return console.error("Failed to get offline queue",e),[]}}static async deleteFromOfflineQueue(e){try{const o=(await this.openDB()).transaction("offlineQueue","readwrite"),r=o.objectStore("offlineQueue");return console.log(`Deleting item with ID ${e} from offline queue`),r.delete(e),new Promise(((r,t)=>{o.oncomplete=()=>{console.log(`Offline queue item ${e} deleted successfully`),r(!0)},o.onerror=()=>{console.error("Error deleting from offline queue",o.error),t(o.error)}}))}catch(o){throw console.error("Failed to delete from offline queue",o),o}}static async clearOfflineQueue(){try{const e=(await this.openDB()).transaction("offlineQueue","readwrite"),o=e.objectStore("offlineQueue");return console.log("Clearing offline queue"),o.clear(),new Promise(((o,r)=>{e.oncomplete=()=>{console.log("Offline queue cleared successfully"),o(!0)},e.onerror=()=>{console.error("Error clearing offline queue",e.error),r(e.error)}}))}catch(e){throw console.error("Failed to clear offline queue",e),e}}}const r=new class{constructor(){this._isOnline=window.navigator.onLine,this._listeners=[],window.addEventListener("online",(()=>{console.log("Network status: ONLINE"),this._isOnline=!0,this._notifyListeners()})),window.addEventListener("offline",(()=>{console.log("Network status: OFFLINE"),this._isOnline=!1,this._notifyListeners()}))}isOnline(){return this._isOnline}addListener(e){this._listeners.push(e)}removeListener(e){this._listeners=this._listeners.filter((o=>o!==e))}_notifyListeners(){this._listeners.forEach((e=>{try{e(this._isOnline)}catch(o){console.error("Error in network status listener:",o)}}))}};new class{constructor(){this.baseUrl="https://story-api.dicoding.dev/v1",r.addListener((e=>{e&&(console.log("Back online! Syncing offline data..."),this.syncOfflineData())}))}async register(e,o,t){try{if(!r.isOnline())throw new Error("Anda sedang offline. Silakan coba lagi saat online.");console.log("Registering user:",e,o);const n=await fetch(`${this.baseUrl}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:o,password:t})}),a=await n.json();if(console.log("Register response:",a),a.error)throw new Error(a.message);return a}catch(n){throw console.error("Registration error:",n),new Error(`Failed to register: ${n.message}`)}}async login(e,o){try{if(!r.isOnline())throw new Error("Anda sedang offline. Silakan coba lagi saat online.");console.log("Login attempt for:",e);const t=await fetch(`${this.baseUrl}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:o})}),n=await t.json();if(console.log("Login response:",n),n.error)throw new Error(n.message);return localStorage.setItem("token",n.loginResult.token),localStorage.setItem("user",JSON.stringify(n.loginResult)),this.registerPushNotification(),n}catch(t){throw console.error("Login error:",t),new Error(`Failed to login: ${t.message}`)}}async getAllStories(){try{const e=localStorage.getItem("token");if(console.log("Getting stories with token:",e?"Token exists":"No token"),!e)throw new Error("Token tidak ditemukan. Silakan login terlebih dahulu.");if(r.isOnline()){console.log("Online mode: fetching stories from API");const r=await fetch(`${this.baseUrl}/stories?location=1`,{headers:{Authorization:`Bearer ${e}`}}),t=await r.json();if(console.log("Stories response:",t),t.error)throw new Error(t.message);return await o.saveStories(t.listStory),t.listStory}{console.log("Offline mode: retrieving stories from IndexedDB");const e=await o.getStories();return e&&0!==e.length?console.log(`Found ${e.length} stories in IndexedDB`):console.log("No stories found in IndexedDB"),e||[]}}catch(e){return console.error("Error fetching stories:",e),e.message.includes("Token tidak ditemukan")&&window.router&&window.router.navigateTo("/masuk"),console.log("Trying to fetch from IndexedDB after error"),await o.getStories()||[]}}async addNewStory(e,t,n,a){try{const i=localStorage.getItem("token");if(console.log("Adding new story with token:",i?"Token exists":"No token"),!i)throw new Error("Token tidak ditemukan. Silakan login terlebih dahulu.");if(!r.isOnline()){console.log("Offline: storing story to IndexedDB for later sync");const r="offline-"+Date.now(),i=URL.createObjectURL(t),s={id:r,name:(JSON.parse(localStorage.getItem("user"))||{}).name||"Offline User",description:e,photoUrl:i,createdAt:(new Date).toISOString(),lat:n,lon:a,isOffline:!0};return await o.saveOfflineStory({description:e,photoBlob:t,lat:n,lon:a,id:r}),await o.saveStories([s]),{error:!1,message:"Cerita disimpan untuk diunggah nanti saat online",story:s}}const s=new FormData;s.append("description",e),s.append("photo",t,"photo.jpg"),null!==n&&null!==a&&(s.append("lat",n),s.append("lon",a)),console.log("Sending request to add story");const l=await fetch(`${this.baseUrl}/stories`,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:s}),c=await l.json();if(console.log("Add story response:",c),c.error)throw new Error(c.message);return this.getAllStories(),c}catch(i){throw console.error("Error adding story:",i),new Error(`Failed to add story: ${i.message}`)}}async syncOfflineData(){console.log("Syncing offline data...");try{const r=localStorage.getItem("token");if(!r)return void console.log("No token available, skipping sync");const t=await o.getOfflineQueue();if(console.log("Offline queue:",t),!t||0===t.length)return void console.log("No offline data to sync");for(const n of t)if("add-story"===n.type){console.log("Syncing offline story:",n);try{const{description:e,photoBlob:t,lat:a,lon:i,id:s}=n.data,l=new FormData;l.append("description",e),l.append("photo",t,"photo.jpg"),null!==a&&null!==i&&(l.append("lat",a),l.append("lon",i)),console.log("Sending offline story to API");const c=await fetch(`${this.baseUrl}/stories`,{method:"POST",headers:{Authorization:`Bearer ${r}`},body:l}),d=await c.json();if(console.log("Add story response for offline item:",d),d.error){console.error("Error syncing offline story:",d.message);continue}await o.deleteStory(s),await o.deleteFromOfflineQueue(n.id),console.log("Offline story synced successfully")}catch(e){console.error("Failed to sync offline story:",e)}}await this.getAllStories()}catch(e){console.error("Error syncing offline data:",e)}}async registerPushNotification(){try{if(console.log("Checking push notification support..."),!("PushManager"in window))return console.log("Push notifications not supported in this browser"),!1;if(!navigator.serviceWorker.controller)return console.log("Service worker not yet controlling the page"),!1;if(console.log("Requesting notification permission..."),"granted"!==await Notification.requestPermission())return console.log("Notification permission denied"),!1;console.log("Notification permission granted, getting VAPID key...");const e=localStorage.getItem("token");if(!e)return console.log("No token available, cannot register for notifications"),!1;const o=await fetch(`${this.baseUrl}/notification`,{headers:{Authorization:`Bearer ${e}`}}),r=await o.json();if(r.error)return console.error("Error getting VAPID key:",r.message),!1;const t=r.data.publicKey;console.log("Got VAPID key, subscribing to push service...");const n=this._urlBase64ToUint8Array(t),a=await navigator.serviceWorker.ready;if(await a.pushManager.getSubscription())return console.log("Already subscribed to push service"),!0;console.log("Creating new push subscription...");const i=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:n});console.log("Push subscription created:",i),console.log("Sending subscription to server...");const s=btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("p256dh")))),l=btoa(String.fromCharCode.apply(null,new Uint8Array(i.getKey("auth")))),c=await fetch(`${this.baseUrl}/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({endpoint:i.endpoint,keys:{p256dh:s,auth:l}})}),d=await c.json();return d.error?(console.error("Push subscription registration error:",d.message),!1):(console.log("Push notification subscription successful"),!0)}catch(e){return console.error("Push notification registration error:",e),!1}}_urlBase64ToUint8Array(e){const o=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(o),t=new Uint8Array(r.length);for(let n=0;n<r.length;++n)t[n]=r.charCodeAt(n);return t}},new class{constructor(){this._element=null,this._init()}_init(){this._element=document.createElement("div"),this._element.className="offline-indicator",this._element.setAttribute("aria-live","polite"),document.body.appendChild(this._element),this._updateStatus(r.isOnline()),r.addListener((e=>{this._updateStatus(e)}))}_updateStatus(e){if(e){this._element.classList.remove("visible"),this._element.innerHTML="";const e=document.createElement("div");e.className="online-msg",e.textContent="Kembali online",document.body.appendChild(e),setTimeout((()=>{e.classList.add("fade-out"),setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e)}),500)}),3e3)}else this._element.classList.add("visible"),this._element.innerHTML='\n        <div class="offline-content">\n          <i class="fas fa-wifi" aria-hidden="true"></i>\n          <span>Anda sedang offline. Beberapa fitur mungkin terbatas.</span>\n        </div>\n      '}},document.addEventListener("DOMContentLoaded",(()=>{const e={async init(){console.log("App initializing..."),await(async()=>{if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");return console.log("Service worker registered with scope:",e.scope),e.waiting&&(console.log("New service worker waiting"),e.waiting.postMessage({type:"SKIP_WAITING"})),e.onupdatefound=()=>{const o=e.installing;o&&(o.onstatechange=()=>{if("installed"===o.state)if(navigator.serviceWorker.controller){console.log("New service worker installed, but will activate on next page load");const e=document.createElement("div");e.className="update-notification",e.innerHTML='\n                <p>Ada pembaruan tersedia untuk aplikasi ini.</p>\n                <button id="updateNowBtn">Perbarui Sekarang</button>\n              ',document.body.appendChild(e),document.getElementById("updateNowBtn").addEventListener("click",(()=>{o.postMessage({type:"SKIP_WAITING"}),e.remove(),window.location.reload()}))}else console.log("Service Worker installed for the first time")})},navigator.serviceWorker.addEventListener("controllerchange",(()=>{console.log("New service worker activated, reloading for clean state")})),e}catch(e){console.error("Service worker registration failed:",e)}else console.log("Service Worker not supported in the browser")})(),console.log("Offline indicator initialized");try{await o.openDB(),console.log("IndexedDB initialized")}catch(d){console.error("Failed to initialize IndexedDB:",d)}const e=new StoryModel(apiService),t=apiService,n=new AppView,a=new HomeView,i=new AddStoryView,s=new LoginView,l=new RegisterView;console.log("Views created");const c=new AppPresenter({view:n,storyModel:e,authModel:t,router:router});new HomePresenter({view:a,model:e}),new AddStoryPresenter({view:i,model:e}),console.log("Creating login presenter..."),new LoginPresenter({view:s,apiService:apiService,router:router}),console.log("Creating register presenter..."),new RegisterPresenter({view:l,apiService:apiService,router:router}),console.log("Presenters initialized"),window.addEventListener("hashchange",(()=>{console.log("Page navigation detected, checking if camera needs to be stopped"),cameraHelper&&cameraHelper.stream&&(console.log("Active camera stream detected during navigation, stopping it"),cameraHelper.stopCamera())})),router.addRoute("/",(()=>{console.log("Navigating to home page"),document.querySelector("#mainContent").innerHTML="";const o=new HomeView;new HomePresenter({view:o,model:e}).init(),o.render()}),{requiresAuth:!0}).addRoute("/tambah",(()=>{console.log("Navigating to add story page"),document.querySelector("#mainContent").innerHTML="";const o=new AddStoryView;o.render(),new AddStoryPresenter({view:o,model:e}).init()}),{requiresAuth:!0}).addRoute("/peta",(()=>{console.log("Navigating to map page"),cameraHelper&&cameraHelper.stream&&(console.log("Active camera stream detected, stopping it"),cameraHelper.stopCamera()),document.querySelector("#mainContent").innerHTML="";const o=new MapView;o.render(),new MapPresenter({view:o,model:e}).init()}),{requiresAuth:!0}).addRoute("/masuk",(()=>{console.log("Rendering login page"),document.querySelector("#mainContent").innerHTML="",s.render()}),{guestOnly:!0}).addRoute("/daftar",(()=>{console.log("Rendering register page"),document.querySelector("#mainContent").innerHTML="",l.render()}),{guestOnly:!0}).setFallback((()=>{console.error("Halaman tidak ditemukan"),document.querySelector("#mainContent").innerHTML="",(new NotFoundView).render()})),console.log("Routes configured"),router.init(),this._setupSkipLink(),this._setupNavigation(),this._setupNavClicks(),c.start(),this._addViewTransitionStyles(),r.isOnline()&&(console.log("Online at startup, checking for offline data to sync"),setTimeout((()=>{e.syncOfflineStories()}),2e3)),console.log("App initialization complete")},_setupSkipLink(){const e=document.querySelector("#mainContent"),o=document.querySelector(".skip-link");e&&o&&o.addEventListener("click",(function(r){r.preventDefault(),o.blur(),e.focus(),e.scrollIntoView()}))},_setupNavigation(){const e=document.getElementById("navToggle"),o=document.querySelector(".nav-menu");e&&o&&e.addEventListener("click",(()=>{const r="true"===e.getAttribute("aria-expanded");e.setAttribute("aria-expanded",!r),o.classList.toggle("active")})),this._updateAuthNavItem(),document.addEventListener("authChanged",(()=>{console.log("Auth status changed"),this._updateAuthNavItem()}))},_setupNavClicks(){document.querySelectorAll("nav a").forEach((e=>{e.addEventListener("click",(o=>{const r=e.getAttribute("href");r.startsWith("#")&&(o.preventDefault(),console.log("Navigation link clicked:",r),router.navigateTo(r.substring(1)))}))}))},_updateAuthNavItem(){const e=document.getElementById("authNavItem");if(e){const o=null!==localStorage.getItem("token");if(console.log("Updating auth nav item, isLoggedIn:",o),o){e.innerHTML='<a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt" aria-hidden="true"></i> Keluar</a>';const o=document.getElementById("logoutBtn");o&&o.addEventListener("click",(e=>{e.preventDefault(),console.log("Logout clicked"),localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("name"),router.navigateTo("/masuk"),document.dispatchEvent(new Event("authChanged"))}))}else e.innerHTML='<a href="#/masuk"><i class="fas fa-sign-in-alt" aria-hidden="true"></i> Masuk</a>'}},_addViewTransitionStyles(){if(!document.getElementById("viewTransitionStyles")){const e=document.createElement("style");e.id="viewTransitionStyles",e.textContent="\n          /* Basic transitions for all browsers */\n          #mainContent {\n            transition: opacity 0.3s ease;\n          }\n          \n          /* View Transitions API specific styles */\n          @supports (view-transition: same) {\n            ::view-transition-old(root) {\n              animation: 300ms cubic-bezier(0.4, 0, 0.2, 1) both fade-out;\n            }\n            \n            ::view-transition-new(root) {\n              animation: 300ms cubic-bezier(0.4, 0, 0.2, 1) both fade-in;\n            }\n            \n            @keyframes fade-in {\n              from { opacity: 0; }\n              to { opacity: 1; }\n            }\n            \n            @keyframes fade-out {\n              from { opacity: 1; }\n              to { opacity: 0; }\n            }\n          }\n        ",document.head.appendChild(e)}}};console.log("Starting app..."),e.init()}))}}}));
